<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign up/ Log in</title>
    <link rel="stylesheet" href="/login.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet">

</head>
<body>
<div class="form-structor">
    <div class="signup">
        <h2 class="form-title" id="signup"><span>or</span>Sign up</h2>
        <div class="form-holder">
            <input type="text" class="input" placeholder="Username" id="signup-username" required />
            <input type="text" class="input" placeholder="Name" id="signup-name" required />

            <!-- Chuyển thành combobox để chọn role -->
            <select id="signup-role" class="input" required>
                <option value="" disabled selected>Role</option>
                <option value="admin">admin</option>
                <option value="user">user</option>
            </select>

            <input type="password" class="input" placeholder="Password" id="signup-password" required />
        </div>
        <button class="submit-btn" id="signup-btn">Sign up</button>
        <!-- Thông báo lỗi cho đăng ký -->
        <div id="signup-error-message" style="color: red; text-align: center; margin-top: 10px;"></div>
    </div>

    <div class="login slide-up">
        <div class="center">
            <h2 class="form-title" id="login"><span>or</span>Log in</h2>
            <div class="form-holder">
                <input type="text" class="input" placeholder="Username" id="login-username" required />

                <!-- Thêm checkbox để hiển thị/tắt mật khẩu -->
                <div style="position: relative;">
                    <input type="password" class="input" placeholder="Password" id="login-password" required />
                    <input type="checkbox" id="show-password" style="position: absolute; top: 0; right: 0; cursor: pointer;" onclick="togglePassword()">
                </div>
            </div>
            <button class="submit-btn" id="login-btn">Log in</button>
            <!-- Thông báo lỗi cho đăng nhập -->
            <div id="login-error-message" style="color: red; text-align: center; margin-top: 10px;"></div>
        </div>
    </div>
    <div class="version">Version 1.1</div>
</div>



<script>
    function clearUsernameOnLoad() {
            // Xóa 'username' khỏi sessionStorage khi trang được mở
            sessionStorage.removeItem('username');
           }

// Script hiện/ẩn mật khẩu ở ô đăng nhập
document.getElementById('show-password').addEventListener('change', function () {
const passwordField = document.getElementById('login-password');
if (this.checked) {
    passwordField.type = 'text';
} else {
    passwordField.type = 'password';
}
});

const loginBtn = document.getElementById('login');
const signupBtn = document.getElementById('signup');

// Chuyển form giữa đăng nhập và đăng ký
loginBtn.addEventListener('click', (e) => {
let parent = e.target.parentNode.parentNode;
Array.from(e.target.parentNode.parentNode.classList).find((element) => {
    if (element !== "slide-up") {
        parent.classList.add('slide-up');
    } else {
        signupBtn.parentNode.classList.add('slide-up');
        parent.classList.remove('slide-up');
    }
});
});

signupBtn.addEventListener('click', (e) => {
let parent = e.target.parentNode;
Array.from(e.target.parentNode.classList).find((element) => {
    if (element !== "slide-up") {
        parent.classList.add('slide-up');
    } else {
        loginBtn.parentNode.parentNode.classList.add('slide-up');
        parent.classList.remove('slide-up');
    }
});
});

document.getElementById('signup-btn').addEventListener('click', async () => {
const username = document.getElementById('signup-username').value;
const name = document.getElementById('signup-name').value;
const role = document.getElementById('signup-role').value;
const password = document.getElementById('signup-password').value;

const response = await fetch('/auth/register', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: new URLSearchParams({
        username,
        name,
        role,
        password,
    }),
});

const message = await response.text();
if (message === "200") {
    // Thông báo đăng ký thành công
    alert("Sign up successful");
    document.getElementById('signup-username').value = '';
    document.getElementById('signup-name').value = '';
    document.getElementById('signup-role').value = '';
    document.getElementById('signup-password').value = '';
    document.getElementById("signup-error-message").innerText = '';
    document.getElementById('login').click();
} else {
    // Hiển thị lỗi nếu đăng ký thất bại
    document.getElementById("signup-error-message").innerText = "Sign up failed, please try again.";
}
});

document.getElementById('login-btn').addEventListener('click', async () => {
const username = document.getElementById('login-username').value;
const password = document.getElementById('login-password').value;

const response = await fetch('/auth/login', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: new URLSearchParams({
        username,
        password,
    }),
});

const message = await response.text();
if (message === "admin") {
    window.location.href = "/admin.html";
} else if (message === "user") {
            sessionStorage.setItem("username", username);
            // Chuyển hướng đến trang dashboard
            window.location.href = "/checkin.html";
} else {

    document.getElementById("login-error-message").innerText = "Login failed, please try again.";
}
});

</script>
</body>
</html>
